machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"

  override:
    - sudo pip install -U docker-compose
    - cp src/db/secrets.example.env src/db/secrets.env
    - (cd src; docker-compose -f docker-production.yml build)
    - (cd src; docker-compose -f docker-production.yml up -d)

test:
  override:
    - docker-compose -f docker-production.yml run webapp grunt test --gruntfile /webapp/client/Gruntfile.js
