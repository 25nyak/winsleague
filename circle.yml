machine:
  node:
    version: 0.10.40 # match this to app/.meteor/local/build/.node_version.txt

general:
  artifacts:
    - "app/.meteor/local/log"
    - "log"

dependencies:
  cache_directories:
    - ~/.meteor
  override:
    - meteor || curl https://install.meteor.com | /bin/sh
    - (cd app; meteor list) # triggers the packages to download and install

test:
  override:
    # Run tests
    - (cd app; meteor run --test)
    # Publish code coverage data to CodeClimate. $CODECLIMATE_REPO_TOKEN is an environment variable setup in CircleCI.
    # Disabled until we get tests reporting to lcov again
    # - npm install -g codeclimate-test-reporter@0.1.1
    # - (cd src/webapp; CODECLIMATE_REPO_TOKEN=$CODECLIMATE_REPO_TOKEN codeclimate-test-reporter < log/coverage/report-lcov/lcov.info)
